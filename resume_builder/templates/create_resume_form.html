
<div class="min-h-screen bg-gray-50 py-8">
    <!-- Progress Bar -->
    <div class="max-w-3xl mx-auto mb-8 px-4">
        <div class="flex justify-between">
            <div class="step active" data-step="1">Personal Info</div>
            <div class="step" data-step="2">Experience</div>
            <div class="step" data-step="3">Education</div>
            <div class="step" data-step="4">Skills</div>
            <div class="step" data-step="5">Additional</div>
        </div>
        <div class="mt-4 h-2 bg-gray-200 rounded-full">
            <div class="progress-bar h-full w-1/5 bg-blue-600 rounded-full transition-all duration-300"></div>
        </div>
    </div>

    <!-- Form Container -->
    <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-md">
        <form id="resumeForm" class="p-6 space-y-6">
            {% csrf_token %}

            <!-- Step 1: Personal Information -->
            <div class="form-step" data-step="1">
                <h2 class="text-2xl font-bold mb-6">Personal Information</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" name="fullName" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Professional Title</label>
                        <input type="text" name="title" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" name="email" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Phone</label>
                        <input type="tel" name="phone"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">Professional Summary</label>
                        <textarea name="summary" rows="4" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>
                </div>
            </div>

            <!-- Step 2: Work Experience -->
            <div class="form-step hidden" data-step="2">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Work Experience</h2>
                    <button type="button" onclick="addExperience()"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        Add Experience
                    </button>
                </div>
                <div id="experienceContainer" class="space-y-6">
                    <!-- Experience entries will be added here -->
                </div>
            </div>

            <!-- Step 3: Education -->
            <div class="form-step hidden" data-step="3">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Education</h2>
                    <button type="button" onclick="addEducation()"
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        Add Education
                    </button>
                </div>
                <div id="educationContainer" class="space-y-6">
                    <!-- Education entries will be added here -->
                </div>
            </div>

            <!-- Step 4: Skills -->
            <div class="form-step hidden" data-step="4">
                <h2 class="text-2xl font-bold mb-6">Skills</h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Technical Skills</label>
                        <input type="text" name="technicalSkills" placeholder="Separate skills with commas"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Soft Skills</label>
                        <input type="text" name="softSkills" placeholder="Separate skills with commas"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Languages</label>
                        <input type="text" name="languages" placeholder="Separate languages with commas"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Step 5: Additional Information -->
            <div class="form-step hidden" data-step="5">
                <h2 class="text-2xl font-bold mb-6">Additional Information</h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Certifications</label>
                        <textarea name="certifications" rows="3"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Projects</label>
                        <textarea name="projects" rows="3"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between mt-8">
                <button type="button" id="prevBtn" onclick="prevStep()"
                    class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 hidden">
                    Previous
                </button>
                <button type="button" id="nextBtn" onclick="nextStep()"
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700">
                    Next
                </button>
                <button type="submit" id="submitBtn"
                    class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 hidden">
                    Create Resume
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Experience Template (Hidden) -->
<template id="experienceTemplate">
    <div class="experience-entry border rounded-lg p-4 relative">
        <button type="button" onclick="removeEntry(this)" class="absolute top-2 right-2 text-red-600 hover:text-red-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Company Name</label>
                <input type="text" name="experience[].company" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Position</label>
                <input type="text" name="experience[].position" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Start Date</label>
                <input type="month" name="experience[].startDate" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">End Date</label>
                <input type="month" name="experience[].endDate"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea name="experience[].description" rows="3" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
            </div>
        </div>
    </div>
</template>

<!-- Education Template (Hidden) -->
<template id="educationTemplate">
    <div class="education-entry border rounded-lg p-4 relative">
        <button type="button" onclick="removeEntry(this)" class="absolute top-2 right-2 text-red-600 hover:text-red-800">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Institution</label>
                <input type="text" name="education[].institution" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Degree</label>
                <input type="text" name="education[].degree" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Start Date</label>
                <input type="month" name="education[].startDate" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">End Date</label>
                <input type="month" name="education[].endDate"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea name="education[].description" rows="3"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
            </div>
        </div>
    </div>
</template>



<script>
    let currentStep = 1;
    const totalSteps = 5;

    function updateProgressBar() {
        const progress = (currentStep - 1) / (totalSteps - 1) * 100;
        document.querySelector('.progress-bar').style.width = `${progress}%`;
    }

    function showStep(step) {
        document.querySelectorAll('.form-step').forEach(el => el.classList.add('hidden'));
        document.querySelector(`.form-step[data-step="${step}"]`).classList.remove('hidden');

        // Update step indicators
        document.querySelectorAll('.step').forEach(el => {
            if (parseInt(el.dataset.step) <= step) {
                el.classList.add('active');
            } else {
                el.classList.remove('active');
            }
        });

        // Show/hide navigation buttons
        document.getElementById('prevBtn').classList.toggle('hidden', step === 1);
        document.getElementById('nextBtn').classList.toggle('hidden', step === totalSteps);
        document.getElementById('submitBtn').classList.toggle('hidden', step !== totalSteps);

        updateProgressBar();
    }

    function nextStep() {
        if (currentStep < totalSteps) {
            currentStep++;
            showStep(currentStep);
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    }

    function addExperience() {
        const template = document.getElementById('experienceTemplate');
        const container = document.getElementById('experienceContainer');
        const clone = template.content.cloneNode(true);
        container.appendChild(clone);
    }

    function addEducation() {
        const template = document.getElementById('educationTemplate');
        const container = document.getElementById('educationContainer');
        const clone = template.content.cloneNode(true);
        container.appendChild(clone);
    }

    function removeEntry(button) {
        button.closest('.experience-entry, .education-entry').remove();
    }

    document.getElementById('resumeForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const data = {};
        
        // Convert FormData to structured object
        for (let [key, value] of formData.entries()) {
            if (key.includes('[]')) {
                // Handle array fields
                const cleanKey = key.replace('[]', '');
                if (!data[cleanKey]) data[cleanKey] = [];
                data[cleanKey].push(value);
            } else if (key.includes('.')) {
                // Handle nested objects (experience and education)
                const [section, index, field] = key.split('.');
                if (!data[section]) data[section] = [];
                if (!data[section][index]) data[section][index] = {};
                data[section][index][field] = value;
            } else {
                // Handle simple fields
                data[key] = value;
            }
        }

        try {
            const response = await fetch('{% url "resume_builder:create_resume_submit" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify(data)
            });

            if (!response.ok) {
                throw new Error('Failed to create resume');
            }

            const result = await response.json();
            if (result.success) {
                window.location.href = result.redirect_url;
            } else {
                throw new Error(result.error || 'Failed to create resume');
            }

        } catch (error) {
            console.error('Error:', error);
            alert('Failed to create resume. Please try again.');
        }
    });

    // Initialize first step
    showStep(1);
</script>

<style>
    .step {
        @apply text-sm font-medium text-gray-500;
    }

    .step.active {
        @apply text-blue-600;
    }

    .form-step {
        transition: all 0.3s ease-in-out;
    }

    .form-step.hidden {
        display: none;
    }
</style>

